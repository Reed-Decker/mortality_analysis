y = Death_Rate,
color = Race,
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Deaths by Mental Disorder")
filter(dat, ICD.Chapter.Code == "F01-F99"
& !is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
color = Race,
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Deaths by Mental Disorder")
filter(dat, ICD.Chapter.Code == "F01-F99"
& !is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population))) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
color = Race,
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Deaths by Mental Disorder")
filter(dat, ICD.Chapter.Code == "F01-F99"
& !is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = (sum(Deaths)) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
color = Race,
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Deaths by Mental Disorder")
filter(dat, ICD.Chapter.Code == "F01-F99"
& !is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = (sum(Deaths))) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
color = Race,
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Deaths by Mental Disorder")
filter(dat, ICD.Chapter.Code == "F01-F99"
& !is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population))) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
color = Race,
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Deaths by Mental Disorder")
filter(dat,
ICD.Chapter.Code %in% death_cause &
Crude.Rate.Reliability == "Reliable") %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = sum(Deaths)/sum(Population)) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
linetype = ICD.Chapter.Code,
color = Race
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Top Causes of Death Over Time by Race") +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
death_cause <- total_deaths$ICD.Chapter.Code[
which(
total_deaths$Deaths > 999999 &
total_deaths$Deaths < 10000000
)
]
filter(dat,
ICD.Chapter.Code %in% death_cause &
Crude.Rate.Reliability == "Reliable") %>%
group_by(ICD.Chapter.Code, Year) %>%
summarise(Death_Rate = sum(Deaths)/sum(Population)) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
color = ICD.Chapter.Code,
linetype = ICD.Chapter.Code
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Common Causes of Death Over Time") +
scale_color_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
) +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
filter(dat,
ICD.Chapter.Code %in% death_cause &
Crude.Rate.Reliability == "Reliable") %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population)) * 1000) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
linetype = ICD.Chapter.Code,
color = Race
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Top Causes of Death Over Time by Race") +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
filter(dat,
ICD.Chapter.Code %in% death_cause &
Crude.Rate.Reliability == "Reliable") %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population)) ) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
linetype = ICD.Chapter.Code,
color = Race
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Top Causes of Death Over Time by Race") +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
death_cause <- c("I00-I99", "C00-D48")
filter(dat,
ICD.Chapter.Code %in% death_cause &
Crude.Rate.Reliability == "Reliable") %>%
group_by(ICD.Chapter.Code, Year) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population)) * 1000) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
group_by = ICD.Chapter.Code,
color = ICD.Chapter.Code,
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_color_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
knitr::opts_chunk$set(echo = TRUE)
library(rstudioapi)
library(tidyverse)
setwd(dirname(getActiveDocumentContext()$path))
dat_american_indian <- read.delim("mortality_1999-2016_american-indian.txt")
dat_american_indian["Race"] <- 'American Indian or Alaska Native'
dat_black <- read.delim("mortality_1999-2016_black.txt")
dat_black["Race"] <- "Black or African American"
dat_asian <- read.delim("mortality_1999-2016_asian.txt")
dat_asian["Race"] <- "Asian or Pacific Islander"
dat_white <- read.delim("mortality_1999-2016_white.txt")
dat_white["Race"] <- "White"
dat <- rbind(dat_american_indian, dat_black, dat_asian, dat_white)
knitr::kable(head(dat))
dat <- subset(dat, Notes != "Total")
apply(dat, 2, function(x) sum(is.na(x)))
year_na <- subset(dat, subset = is.na(dat$Year))
head(year_na)
dat <- subset(dat, subset = !is.na(dat$Year))
apply(dat, 2, function(x) sum(x == ""))
unique(dat$Gender)
unique(dat$Age.Group)
unique(dat$ICD.Chapter)
unique(dat$Hispanic.Origin)
gender_key <- unique(dat[, c("Gender.Code", "Gender")])
age_key <- unique(dat[, c("Age.Group.Code", "Age.Group")])
icd_key <- unique(dat[, c("ICD.Chapter.Code", "ICD.Chapter")])
hispanic_key <- unique(dat[, c("Hispanic.Origin.Code", "Hispanic.Origin")])
icd_key$ICD.Chapter <- c("Parasitic Diseases",
"Neoplams",
"Blood Diseases",
"Endocrine Diseases",
"Mental Disorders",
"Nervous System Diseases",
"Eye Diseases",
"Ear Diseases",
"Circulatory Diseases",
"Respiratory Diseases",
"Digestive Diseases",
"Skin Diseases",
"Muscular Diseases",
"Genitourinary Diseases",
"Pregnancy/Childbirth",
"Perinatal Conditions",
"Congenital Malformations",
"Not Classified Elsewhere",
"Special Purposes",
"External Causes"
)
dat <- subset(dat, select = -c(1, 3, 4, 6, 8, 10))
str(dat)
dat <- dat %>%
separate(Crude.Rate,
c("Crude.Rate", "Crude.Rate.Reliability"),
sep = " ") %>%
mutate(Crude.Rate.Reliability =
replace_na(Crude.Rate.Reliability, "Reliable"))
dat$Crude.Rate.Reliability <- gsub(
"(\\()|(\\))",
"",
dat$Crude.Rate.Reliability
)
length(grep("(^$)|([0-9])", dat$Crude.Rate, invert = TRUE))
crude_non_numeric <- subset(
dat,
subset = !grepl(
"(^$)|([0-9])",
dat$Crude.Rate
)
)
head(crude_non_numeric)
dat$Crude.Rate <- gsub("Not", "0.0", dat$Crude.Rate)
dat$Crude.Rate.Reliability <- gsub(
"Applicable",
"(Not Applicable)",
dat$Crude.Rate.Reliability
)
length(grep('(^$)|([0-9])', dat$Crude.Rate, invert = TRUE))
length(grep("([0-9])|(Not Applicable)", dat$Population, invert = TRUE))
unique(dat$Gender.Code)
unique(dat$Age.Group.Code)
unique(dat$ICD.Chapter.Code)
unique(dat$Hispanic.Origin.Code)
unique(dat$Race)
factors <- c ("Gender.Code",
"Age.Group.Code",
"ICD.Chapter.Code",
"Hispanic.Origin.Code",
"Crude.Rate.Reliability",
"Race")
dat[,factors] <- lapply(dat[,factors],
factor)
dat$Crude.Rate <- as.numeric(dat$Crude.Rate)
dat$Population <- as.integer(dat$Population)
apply(dat, 2, function(x) sum(is.na(x)))
total_deaths <- dat %>%
left_join(icd_key, by = c("ICD.Chapter.Code" = "ICD.Chapter.Code")) %>%
group_by(ICD.Chapter.Code, ICD.Chapter) %>%
summarise(Deaths = sum(Deaths)) %>%
arrange(desc(Deaths))
print(total_deaths)
death_cause <- c("I00-I99", "C00-D48")
filter(dat,
ICD.Chapter.Code %in% death_cause &
Crude.Rate.Reliability == "Reliable") %>%
group_by(ICD.Chapter.Code, Year) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population)) * 1000) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
group_by = ICD.Chapter.Code,
color = ICD.Chapter.Code,
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_color_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
filter(dat,
ICD.Chapter.Code %in% death_cause &
Crude.Rate.Reliability == "Reliable") %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population)) ) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
linetype = ICD.Chapter.Code,
color = Race
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Top Causes of Death Over Time by Race") +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
filter(dat,
ICD.Chapter.Code %in% death_cause &
!= is.na(Population)) %>%
filter(dat,
ICD.Chapter.Code %in% death_cause &
!is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population)) ) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
linetype = ICD.Chapter.Code,
color = Race
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Top Causes of Death Over Time by Race") +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
filter(dat,
ICD.Chapter.Code %in% death_cause &
!is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year, Race) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population)) * 1000) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
linetype = ICD.Chapter.Code,
color = Race
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Top Causes of Death Over Time by Race") +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
death_cause <- total_deaths$ICD.Chapter.Code[
which(
total_deaths$Deaths > 999999 &
total_deaths$Deaths < 10000000
)
]
filter(dat,
ICD.Chapter.Code %in% death_cause &
!is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year) %>%
summarise(Death_Rate = sum(Deaths)/sum(Population)) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
color = ICD.Chapter.Code,
linetype = ICD.Chapter.Code
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Common Causes of Death Over Time") +
scale_color_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
) +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
death_cause <- total_deaths$ICD.Chapter.Code[
which(
total_deaths$Deaths > 999999 &
total_deaths$Deaths < 10000000
)
]
filter(dat,
ICD.Chapter.Code %in% death_cause &
!is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population)) * 1000) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
color = ICD.Chapter.Code,
linetype = ICD.Chapter.Code
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Common Causes of Death Over Time") +
scale_color_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
) +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
death_cause <- c("I00-I99", "C00-D48")
filter(dat,
ICD.Chapter.Code %in% death_cause &
!is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population)) * 1000) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
group_by = ICD.Chapter.Code,
color = ICD.Chapter.Code,
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_color_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
install.packages(c("broom", "callr", "dtplyr", "evaluate", "forcats", "googlesheets4", "haven", "hms", "httr", "knitr", "modelr", "pillar", "readxl", "reprex", "rlang", "rmarkdown", "rstudioapi", "rvest", "scales", "stringr", "tinytex", "viridisLite", "xfun"))
install.packages("rlang")
source("~/data_portfolio/mortality_analysis/mortality_analysis_script.R", echo=TRUE)
library(tidyverse)
renv::deactivate()
# Setup ----
library(renv)
library(rstudioapi)
library(tidyverse)
renv::init()
remove.packages("renv")
install.packages("renv")
# Setup ----
library(renv)
library(rstudioapi)
library(tidyverse)
renv:init
renv::init()
remove.packages("renv")
install.packages("renv")
remove.packages("renv")
install.packages("renv")
install.packages("renv")
getwd()
library(rstudioapi)
library(tidyverse)
# Setup ----
library(renv)
renv::init()
getwd()
# Setup ----
library(renv)
renv:init()
renv::init()
renv::deactivate()
setwd(dirname(getActiveDocumentContext()$path))
# Setup ----
library(renv)
library(rstudioapi)
library(tidyverse)
setwd(dirname(getActiveDocumentContext()$path))
renv::init()
install.packages("rlang")
