library(tidyverse)
setwd(dirname(getActiveDocumentContext()$path))
renv::restore()
df <- read.delim("mortality_1999-2016.txt")
# Data Cleaning ----
# Remove columns with the "Total" value
df <- subset(df, Notes != "Total")
# Check for NA values
apply(df, 2, function(x) sum(is.na(x)))
knitr::opts_chunk$set(echo = TRUE)
library(renv)
library(rstudioapi)
library(tidyverse)
setwd(dirname(getActiveDocumentContext()$path))
renv::restore()
df <- read.delim("mortality_1999-2016.txt")
dim(df)
str(df)
knitr::kable(head(df))
df <- subset(df, Notes != "Total")
# Count NA values by column
apply(df, 2, function(x) sum(is.na(x)))
knitr::opts_chunk$set(echo = TRUE)
library(renv)
library(rstudioapi)
library(tidyverse)
setwd(dirname(getActiveDocumentContext()$path))
renv::restore()
df <- read.delim("mortality_1999-2016.txt")
dim(df)
str(df)
knitr::kable(head(df))
df <- subset(df, Notes != "Total")
year_na <- subset(df, subset = is.na(df$Year))
head(year_na)
year_na <- subset(df, subset = is.na(df$Year))
knitr::kable(head(year_na))
View(year_na)
apply(dat, 2, function(x) sum(x == ""))
apply(df, 2, function(x) sum(x == ""))
df <- subset(df, subset = !is.na(df$Year))
apply(df, 2, function(x) sum(x == ""))
length(df)
height(df)
dim(df)
unique(df$ICD.Chapter)
unique(df$ICD.Chapter.Code)
unique(df$Year)
unique(df$Year.Code)
unique(df$Age.Group)
unique(df$Age.Group.Code)
unique(df$Gender)
unique(df$Gender.Code)
unique(df$Race)
unique(df$Race.Code)
View(df)
unique(df$ICD.Chapter)
unique(df$ICD.Chapter.Code)
unique(df$Age.Group)
unique(df$Age.Group.Code)
unique(df$Gender)
unique(df$Gender.Code)
unique(df$Race)
unique(df$Race.Code)
factors <- c("ICD.Chapter.Code",
"Age.Group.Code",
"Gender.Code",
"Race.Code")
str(df)
df <- subset(df, subset = df$Age.Group != "Not Stated")
factors <- c("ICD.Chapter.Code",
"Age.Group.Code",
"Gender.Code",
"Race.Code")
df[,factors] <- lapply(df[,factors], factor)
length(grep("(^$)|([0-9])", df$Population, invert = TRUE))
df$Deaths <- as.integer(df$Deaths)
str(df)
df$Population <- as.integer(df$Population)
str(df)
gender_key <- unique(df[, c("Gender.Code", "Gender")])
age_key <- unique(df[, c("Age.Group.Code", "Age.Group")])
icd_key <- unique(df[, c("ICD.Chapter.Code", "ICD.Chapter")])
race_key <- unique(df[, c("Race.Code", "Race")])
icd_key$ICD.Chapter <- c("Parasitic Diseases",
"Neoplams",
"Blood Diseases",
"Endocrine Diseases",
"Mental Disorders",
"Nervous System Diseases",
"Eye Diseases",
"Ear Diseases",
"Circulatory Diseases",
"Respiratory Diseases",
"Digestive Diseases",
"Skin Diseases",
"Muscular Diseases",
"Genitourinary Diseases",
"Pregnancy/Childbirth",
"Perinatal Conditions",
"Congenital Malformations",
"Not Classified Elsewhere",
"Special Purposes",
"External Causes"
)
dat <- subset(dat, select = -c(1, 3, 4, 6, 8, 10, 14))
df <- subset(df, select = -c(1, 2, 5, 6, 8, 10, 14))
# Function takes the name of the dataframe, then the name(s) of any grouping variables of interest
age_adjust <- function(X, ...){
# Age.Group.Call needs to be included alongside the specific groups listed in the function call.
X <- group_by(X, ..., Age.Group.Code)
X <- summarise(X, Population = sum(Population), Deaths = sum(Deaths))
# Calculate crude rate for each age group
X$Crude.Rate <- (X$Deaths * 100000) / X$Population
# Add in the age weights from the age_key dataframe
X <- merge(
X,
age_key[, c("Age.Group.Code", "Age.Weight")],
by = "Age.Group.Code"
)
# Multiply crude rates by age weight and sum across age groups for finished product
X$Age.Adjustment <- X$Age.Weight * X$Crude.Rate
X <- group_by(X, ...)
X <- summarise(X, Crude.Rate.Adjusted = sum(Age.Adjustment))
return(X)
}
total_deaths <- df %>%
left_join(icd_key, by = c("ICD.Chapter.Code" = "ICD.Chapter.Code")) %>%
group_by(ICD.Chapter.Code, ICD.Chapter) %>%
summarise(Deaths = sum(Deaths)) %>%
arrange(desc(Deaths))
print(total_deaths)
death_cause <- c("I00-I99", "C00-D48")
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year) %>%
ggplot(aes(x = Year, y = Crude.Rate.Adjusted, color = ICD.Chapter.Code)) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_color_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
)
View(df)
knitr::opts_chunk$set(echo = TRUE)
library(renv)
library(rstudioapi)
library(tidyverse)
setwd(dirname(getActiveDocumentContext()$path))
renv::restore()
df <- read.delim("mortality_1999-2016.txt")
dim(df)
str(df)
knitr::kable(head(df))
df <- subset(df, Notes != "Total")
apply(df, 2, function(x) sum(is.na(x)))
year_na <- subset(df, subset = is.na(df$Year))
knitr::kable(head(year_na))
df <- subset(df, subset = !is.na(df$Year))
apply(df, 2, function(x) sum(x == ""))
dim(df)
unique(df$ICD.Chapter)
unique(df$ICD.Chapter.Code)
unique(df$Age.Group)
unique(df$Age.Group.Code)
unique(df$Gender)
unique(df$Gender.Code)
unique(df$Race)
unique(df$Race.Code)
df <- subset(df, subset = df$Age.Group != "Not Stated")
factors <- c("ICD.Chapter.Code",
"Age.Group.Code",
"Gender.Code",
"Race.Code")
df[,factors] <- lapply(df[,factors], factor)
length(grep("(^$)|([0-9])", df$Population, invert = TRUE))
df$Population <- as.integer(df$Population)
gender_key <- unique(df[, c("Gender.Code", "Gender")])
age_key <- unique(df[, c("Age.Group.Code", "Age.Group")])
icd_key <- unique(df[, c("ICD.Chapter.Code", "ICD.Chapter")])
race_key <- unique(df[, c("Race.Code", "Race")])
icd_key$ICD.Chapter <- c("Parasitic Diseases",
"Neoplams",
"Blood Diseases",
"Endocrine Diseases",
"Mental Disorders",
"Nervous System Diseases",
"Eye Diseases",
"Ear Diseases",
"Circulatory Diseases",
"Respiratory Diseases",
"Digestive Diseases",
"Skin Diseases",
"Muscular Diseases",
"Genitourinary Diseases",
"Pregnancy/Childbirth",
"Perinatal Conditions",
"Congenital Malformations",
"Not Classified Elsewhere",
"Special Purposes",
"External Causes"
)
df <- subset(df, select = -c(1, 2, 5, 6, 8, 10, 14))
age_key$Age.Weight <- c(0.013818, # <1
0.055317, # 1-4
0.145565, # 5-9
0.145565, # 10-14
0.138646, # 15-19
0.138646, # 20-24
0.135573, # 25-34
0.162613, # 35-44
0.134834, # 45-54
0.087247, # 55-64
0.066037, # 65-74
0.044842, # 75-84
0.015508  # >=85
)
# Function takes the name of the dataframe, then the name(s) of any grouping variables of interest
age_adjust <- function(X, ...){
# Age.Group.Call needs to be included alongside the specific groups listed in the function call.
X <- group_by(X, ..., Age.Group.Code)
X <- summarise(X, Population = sum(Population), Deaths = sum(Deaths))
# Calculate crude rate for each age group
X$Crude.Rate <- (X$Deaths * 100000) / X$Population
# Add in the age weights from the age_key dataframe
X <- merge(
X,
age_key[, c("Age.Group.Code", "Age.Weight")],
by = "Age.Group.Code"
)
# Multiply crude rates by age weight and sum across age groups for finished product
X$Age.Adjustment <- X$Age.Weight * X$Crude.Rate
X <- group_by(X, ...)
X <- summarise(X, Crude.Rate.Adjusted = sum(Age.Adjustment))
return(X)
}
total_deaths <- df %>%
left_join(icd_key, by = c("ICD.Chapter.Code" = "ICD.Chapter.Code")) %>%
group_by(ICD.Chapter.Code, ICD.Chapter) %>%
summarise(Deaths = sum(Deaths)) %>%
arrange(desc(Deaths))
print(total_deaths)
death_cause <- c("I00-I99", "C00-D48")
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year) %>%
ggplot(aes(x = Year, y = Crude.Rate.Adjusted, color = ICD.Chapter.Code)) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_color_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
)
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year, Gender.Code) %>%
ggplot(
aes(
x = Year,
y = Crude.Rate.Adjusted,
shape = ICD.Chapter.Code,
color = Race.Code
)
) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_shape_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
) #+
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year, Gender.Code) %>%
ggplot(
aes(
x = Year,
y = Crude.Rate.Adjusted,
shape = ICD.Chapter.Code,
color = Gender.Code
)
) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_shape_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
) #+
#scale_color_discrete(labels = race_key$Race, name = "Race")
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year, Gender.Code) %>%
ggplot(
aes(
x = Year,
y = Crude.Rate.Adjusted,
shape = ICD.Chapter.Code,
color = Gender.Code
)
) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_shape_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
) +
scale_color_discrete(labels = gender_key$Gender, name = "Gender")
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year, Gender.Code, Race.Code) %>%
ggplot(
aes(
x = Year,
y = Crude.Rate.Adjusted,
shape = ICD.Chapter.Code,
color = Gender.Code,
linetype = Race.Code
)
) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_shape_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
) +
scale_color_discrete(labels = gender_key$Gender, name = "Gender") +
scale_linetype_discrete(labels = race_key$Race)
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year, Gender.Code) %>%
ggplot(
aes(
x = Year,
y = Crude.Rate.Adjusted,
shape = ICD.Chapter.Code,
color = Gender.Code
)
) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_shape_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
) +
scale_color_discrete(labels = gender_key$Gender, name = "Gender")
death_cause <- total_deaths$ICD.Chapter.Code[
which(
total_deaths$Deaths > 999999 &
total_deaths$Deaths < 10000000
)
]
filter(dat,
ICD.Chapter.Code %in% death_cause &
!is.na(Population)) %>%
group_by(ICD.Chapter.Code, Year) %>%
summarise(Death_Rate = (sum(Deaths)/sum(Population)) * 1000) %>%
ggplot(
aes(
x = Year,
y = Death_Rate,
color = ICD.Chapter.Code,
linetype = ICD.Chapter.Code
)
) +
geom_line() +
ylab("Crude Death Rate") +
labs(title = "Common Causes of Death Over Time") +
scale_color_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
) +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
]
)
death_cause <- total_deaths$ICD.Chapter.Code[
which(
total_deaths$Deaths > 999999 &
total_deaths$Deaths < 10000000
)
]
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year) %>%
ggplot(aes(x = Year, y = Crude.Rate.Adjusted, color = ICD.Chapter.Code)) +
geom_line() +
geom_point(aes(shape = ICD.Chapter.Code)) +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Common Causes of Death Over Time") +
scale_color_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
) +
scale_linetype_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
) +
scale_shape_manual(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death",
values = c(15, 16, 17, 15, 16, 17, 15, 16)
)
death_cause <- c("I00-I99", "C00-D48")
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year, Race.Code) %>%
ggplot(
aes(
x = Year,
y = Crude.Rate.Adjusted,
shape = ICD.Chapter.Code,
color = Race.Code
)
) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_shape_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
) +
scale_color_discrete(labels = race_key$Race, name = "Race")
icd_key
filter(df, ICD.Chapter.Code == "O00-O99") %>%
age_adjust(ICD.Chapter.Code, Year, Race.Code) %>%
ggplot(aes(x = Year, y = Crude.Rate.Adjusted, color = Race.Code)) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Deaths from Mental Illness by Race") +
scale_color_discrete(labels = race_key$Race, name = "Race")
filter(df, ICD.Chapter.Code == "O00-O99") %>%
age_adjust(ICD.Chapter.Code, Year, Race.Code) %>%
ggplot(aes(x = Year, y = Crude.Rate.Adjusted, color = Race.Code)) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Deaths from Pregnancy/Childbirth by Race") +
scale_color_discrete(labels = race_key$Race, name = "Race")
death_cause <- c("I00-I99", "C00-D48")
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year, Race.Code) %>%
ggplot(
aes(
x = Year,
y = Crude.Rate.Adjusted,
shape = ICD.Chapter.Code,
color = Race.Code
)
) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_shape_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
) +
scale_color_discrete(labels = race_key$Race, name = "Race")
death_cause <- c("I00-I99", "C00-D48")
filter(df, ICD.Chapter.Code %in% death_cause) %>%
age_adjust(ICD.Chapter.Code, Year, Race.Code) %>%
ggplot(
aes(
x = Year,
y = Crude.Rate.Adjusted,
shape = ICD.Chapter.Code,
color = Race.Code
)
) +
geom_line() +
geom_point() +
ylab("Age Adjusted Crude Death Rate") +
labs(title = "Top Causes of Death Over Time") +
scale_shape_discrete(
labels = icd_key$ICD.Chapter[
icd_key$ICD.Chapter.Code %in% death_cause
],
name = "Cause of Death"
) +
scale_color_discrete(labels = race_key$Race, name = "Race")
